<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<script src="//use.typekit.net/ndx7bht.js"></script>
		<script>try{Typekit.load();}catch(e){}</script>
		<link rel="stylesheet" type="text/css" href="style.css">
		<script type="text/javascript" src="p5/p5.js"></script>
		<style>
			html, body{
				margin: 0;
				padding: 0;
				background: #333333;
			}
		</style>
	</head>
	<script type="text/javascript">

	// Global variables
	var WIDTH = 1200;
	var HEIGHT = 2000;
	var maxValue = 0;
	var maxRectLength = 500;
	var rectHeight = 8;
	var drawValues = [];
	var drawNames = [];
	var drawNumbers = [];
	var spaceBetween = 15;
	var startDataY = 100;
	var marginX = 20;
	var buttonWidth = 100;
	var buttonHeight = 25;
	var suppliers = true;
	var mainButtonsY = 20;
	var secondaryPosition = 0;
	var secondaryButtonsY = 50;

	function preload(){
		console.log('Starting the loading process...')
		suppliersTable = loadTable('data/05_Supplier_MarketCap.csv');
		customersTable = loadTable('data/05_Customer_MarketCap.csv');
		console.log('Done loading base data...');
	}

	function setup(){
		console.log('Starting the setup...');
		createCanvas(WIDTH, HEIGHT);
		colorMode(HSB, 360, 100, 100, 100);
		textFont("din-condensed-web")

		// Calculate maximum value
		for (var i = 1; i < suppliersTable.getRowCount(); i++) {
			if (suppliersTable.getColumn(4)[i] != 'N/A'){
				maxValue = max(suppliersTable.getColumn(4)[i], maxValue);
			}
			else {
			}
		};

		// Calculate initial draw values
		for (var i = 1; i < suppliersTable.getRowCount(); i++) {
			drawValues[i-1] = map(suppliersTable.getColumn(4)[i], 0, maxValue, 0, maxRectLength);
			drawNames[i-1] = suppliersTable.getColumn(1)[i];
			drawNumbers[i-1] = suppliersTable.getColumn(4)[i];
		};
	}

	function drawButtons(){
		// Main buttons
		var position = 0;
		if (suppliers){
			position = 0;
		}
		else {
			position = 1;
		}
		fill(0, 0, 30);
		noStroke();
		rect(marginX + (buttonWidth + 10) * position, mainButtonsY, buttonWidth, buttonHeight);
		noFill();
		stroke(0, 0, 100);
		strokeWeight(1);
		rect(marginX, mainButtonsY, buttonWidth, buttonHeight);
		rect(marginX + 10 + buttonWidth, mainButtonsY, buttonWidth, buttonHeight);
		noStroke();
		fill(0, 0, 100);
		textAlign(CENTER);
		text("SUPPLIERS", marginX + buttonWidth / 2, mainButtonsY + 5 + buttonHeight / 2);
		text("CUSTOMERS", marginX + buttonWidth / 2 + 10 + buttonWidth, mainButtonsY + 5 + buttonHeight / 2);

		// Secondary buttons
		fill(0, 0, 30);
		noStroke();
		rect(marginX + (buttonWidth + 10) * secondaryPosition, secondaryButtonsY, buttonWidth, buttonHeight);
		noFill();
		stroke(0, 0, 100);
		strokeWeight(1);
		for (var i = 0; i < 3; i++){
			rect(marginX + (buttonWidth + 10) * i, secondaryButtonsY, buttonWidth, buttonHeight);
		}
		noStroke();
		fill(0, 0, 100);
		textAlign(CENTER);
		text("MARKET CAP", marginX + buttonWidth / 2, secondaryButtonsY + 5 + buttonHeight / 2);
		text("PERCENT COST", marginX + buttonWidth / 2 + 10 + buttonWidth, secondaryButtonsY + 5 + buttonHeight / 2);
		text("PERCENT REVENUE", marginX + buttonWidth / 2 + 20 + buttonWidth * 2, secondaryButtonsY + 5 + buttonHeight / 2);
	}

	function draw(){
		background(360, 0, 20);

		drawButtons();
		checkHover();

		fill(0, 0, 100);
		noStroke();
		for (var i = 0; i < drawValues.length; i++){
			rect(105, startDataY + spaceBetween * i, drawValues[i], rectHeight);
		};
		textSize(10);
		textAlign(RIGHT);
		for (var i = 0; i < drawNames.length; i++) {
			text(drawNames[i], 100, startDataY + 7 + spaceBetween * (i));
		};
		textAlign(LEFT);
		for (var i = 0; i < drawNumbers.length; i++) {
			if (drawNumbers[i] > 999){
				text((int(drawNumbers[i])/100)+' B', 110 + drawValues[i], startDataY + 7 + spaceBetween * (i));
			}
			else if (drawNumbers[i] == 'N/A'){
				text('N/A', 110, startDataY + 7 + spaceBetween * (i));
			}
			else {
				text(int(drawNumbers[i])+' M', 110 + drawValues[i], startDataY + 7 + spaceBetween * (i));
			}
		};
	}

	function calculateValues(){
		maxValue = 0;
		if (suppliers){
			for (var i = 1; i < suppliersTable.getRowCount(); i++) {
				if (suppliersTable.getColumn(4)[i] != 'N/A'){
					maxValue = max(suppliersTable.getColumn(4)[i], maxValue);
				}
				else {
				}
			};
			for (var i = 1; i < suppliersTable.getRowCount(); i++) {
				drawValues[i-1] = map(suppliersTable.getColumn(4)[i], 0, maxValue, 0, maxRectLength);
				drawNames[i-1] = suppliersTable.getColumn(1)[i];
				drawNumbers[i-1] = suppliersTable.getColumn(4)[i];
			};
		}
		else {
			for (var i = 1; i < customersTable.getRowCount(); i++) {
				if (customersTable.getColumn(4)[i] != 'N/A'){
					maxValue = max(customersTable.getColumn(4)[i], maxValue);
				}
				else {
				}
			};
			for (var i = 1; i < customersTable.getRowCount(); i++) {
				drawValues[i-1] = map(customersTable.getColumn(4)[i], 0, maxValue, 0, maxRectLength);
				drawNames[i-1] = customersTable.getColumn(1)[i];
				drawNumbers[i-1] = customersTable.getColumn(4)[i];
			};
		}
	}

	function mousePressed(){
		if (marginX < mouseX && mouseX < marginX + buttonWidth && mainButtonsY < mouseY && mouseY < mainButtonsY + buttonHeight){
			suppliers = true;
			calculateValues();
			console.log('suppliers');
		}
		if (marginX + buttonWidth + 10 < mouseX && mouseX < marginX + buttonWidth * 2 + 20 && mainButtonsY < mouseY && mouseY < mainButtonsY + buttonHeight){
			suppliers = false;
			calculateValues();
			console.log('customers');
		}
		if (marginX < mouseX && mouseX < marginX + buttonWidth && secondaryButtonsY < mouseY && mouseY < secondaryButtonsY + buttonHeight){
			secondaryPosition = 0;
			calculateValues();
			console.log('market cap');
		}
		if (marginX + buttonWidth + 10 < mouseX && mouseX < marginX + buttonWidth * 2 + 10 && secondaryButtonsY < mouseY && mouseY < secondaryButtonsY + buttonHeight){
			secondaryPosition = 1;
			calculateValues();
			console.log('percent cost');
		}
		if (marginX + buttonWidth * 2 + 20 < mouseX && mouseX < marginX + buttonWidth * 3 + 20 && secondaryButtonsY < mouseY && mouseY < secondaryButtonsY + buttonHeight){
			secondaryPosition = 2;
			calculateValues();
			console.log('percent revenue');
		}
	}

	function checkHover(){
		if ((marginX < mouseX && mouseX < marginX + buttonWidth && mainButtonsY < mouseY && mouseY < mainButtonsY + buttonHeight) || (marginX + buttonWidth + 10 < mouseX && mouseX < marginX + buttonWidth * 2 + 20 && mainButtonsY < mouseY && mouseY < mainButtonsY + buttonHeight) || (marginX < mouseX && mouseX < marginX + buttonWidth && secondaryButtonsY < mouseY && mouseY < secondaryButtonsY + buttonHeight) || (marginX + buttonWidth + 10 < mouseX && mouseX < marginX + buttonWidth * 2 + 10 && secondaryButtonsY < mouseY && mouseY < secondaryButtonsY + buttonHeight) || (marginX + buttonWidth * 2 + 20 < mouseX && mouseX < marginX + buttonWidth * 3 + 20 && secondaryButtonsY < mouseY && mouseY < secondaryButtonsY + buttonHeight)){
			cursor(HAND);
		}
		else {
			cursor(ARROW);
		}
	}

	</script>
</html>